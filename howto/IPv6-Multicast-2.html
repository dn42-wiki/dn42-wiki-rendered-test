<!DOCTYPE html>
<html>

<!-- Mirrored from 127.0.0.1:4567/howto/IPv6-Multicast.md by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 15 Aug 2022 13:08:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta http-equiv="Content-type" content="text/html;charset=utf-8">
  <meta name="MobileOptimized" content="width">
  <meta name="HandheldFriendly" content="true">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" type="text/css" href="../gollum/assets/app-309be032396e783b13a47df58f389b7c8e11c2b2d42640560b874f677c25f6e5.css" media="all">
  <link rel="stylesheet" type="text/css" href="../gollum/assets/print-512498c368be0d3fb1ba105dfa84289ae48380ec9fcbef948bd4e23b0b095bfb.css" media="print">

  <link rel="stylesheet" type="text/css" href="../custom.css" media="all">
  

  <script>
  var criticMarkup = '';
	var baseUrl = '';
  var showLocalTime = false;
	var uploadDest = 'uploads';
	var perPageUploads = '';
	if (perPageUploads == 'true') {
	  uploadDest = uploadDest + window.location.pathname.replace(/.*gollum\/[-\w]+\//, "/").replace(/\.[^/.]+$/, "").replace(baseUrl, "")
	}
	  var pageFullPath = 'howto/IPv6-Multicast.md';
    var pageFormat   = 'markdown';

  </script>
  <script src="../gollum/assets/app-f05401ee374f0c7f48fc2bc08e30b4f4db705861fd5895ed70998683b383bfb5.js" type="text/javascript"></script>
  

  <title>IPv6-Multicast</title>
</head>
<body>
<div class="container-lg clearfix">
<div id="wiki-wrapper" class="page">
<div id="head">
	<nav class="TableObject
            actions
            border-bottom
            border-md-0
            p-2
            pt-lg-4
            px-lg-0
            overflow-x-scroll">
  <div class="TableObject-item hide-lg hide-xl">
    <details class="details-reset details-overlay">
      <summary class="btn btn-invisible" aria-haspopup="true">
        <span aria-label="Open menu">â˜°</span>
      </summary>
    
      <div class="SelectMenu mx-sm-2">
        <div class="SelectMenu-modal">
          <div class="SelectMenu-divider py-3">
            <h2 class="h6">Current Page</h2>
            <div>IPv6-Multicast</div>
          </div>
    
            <a
              class="SelectMenu-item"
              href="../gollum/history/howto/IPv6-Multicast.html"
              role="menuitem"
            >
              <span>History</span>
            </a>
    
    
          <div class="SelectMenu-divider py-3">
            <h2 class="h6">Main Menu</h2>
          </div>
    
          <div class="SelectMenu-list">
            <a class="SelectMenu-item" role="menuitem" href="../index.html">
              Home
            </a>
    
              <a class="SelectMenu-item" role="menuitem" href="../gollum/overview.html">
                Overview
              </a>
    
              <a
                class="SelectMenu-item"
                href="../gollum/latest_changes.html"
                role="menuitem"
              >
                Latest Changes
              </a>
          </div>
        </div>
      </div>
    </details>
  </div>

  <div class="TableObject-item hide-sm hide-md">
    <a class="btn btn-sm" id="minibutton-home" href="../index.html">
      Home
    </a>
  </div>

  <div
    class="TableObject-item TableObject-item--primary px-2"
    
  >
    <form class="search-form" action="http://127.0.0.1:4567/gollum/search" method="get" id="search-form">
    	<input type="text" class="form-control input-block" name="q" id="search-query" placeholder="Search" aria-label="Search site" autocomplete="off">
    </form>  </div>

  <div class="TableObject-item hide-sm hide-md">
    <div class="BtnGroup d-flex">
        <a
          class="btn BtnGroup-item btn-sm"
          href="../gollum/overview.html"
          id="minibutton-overview"
        >
          Overview
        </a>

        <a
          class="btn BtnGroup-item btn-sm"
          href="../gollum/latest_changes.html"
          id="minibutton-latest-changes"
        >
          Latest Changes
        </a>
    </div>
  </div>

  <div class="TableObject-item px-2">
    <div class="BtnGroup d-flex">
        <a
          class="btn BtnGroup-item btn-sm hide-sm hide-md"
          href="../gollum/history/howto/IPv6-Multicast.md/index.html"
          id="minibutton-history"
        >
          History
        </a>

    </div>
  </div>

</nav>

</div>

<div id="wiki-content" class="px-2 px-lg-0">
  <h1 class="header-title text-center text-md-left pt-4">
    IPv6-Multicast
  </h1>
	<div class="breadcrumb"><nav aria-label="Breadcrumb"><ol>
<li class="breadcrumb-item"><a href="../gollum/overview/howto/index.html">howto</a></li>
</ol></nav></div>

	<div class="has-header has-footer has-sidebar has-rightbar">
	  <div id="wiki-body" class="gollum-markdown-content">
	    <div id="wiki-header" class="gollum-markdown-content">
	      <div id="header-content" class="markdown-body">
	        <p><a href="../index.html" rel="nofollow"><img src="../dn42.png" alt="dn42" /></a></p>

	      </div>
	    </div>
	    <div class="main-content clearfix container-lg">
	      <div class="markdown-body  float-md-left col-md-9" >
	        
	        <h1><a class="anchor" id="ipv6-multicast" href="#ipv6-multicast"></a>IPv6 Multicast</h1>

<p>The following guide illustrates how to set up an IPv6 multicast router using <a href="https://en.wikipedia.org/wiki/Protocol_Independent_Multicast#Sparse_mode">PIM-SM</a> (Protocol Independent Multicast in Sparse Mode) with your own personal multicast prefix.</p>

<h2><a class="anchor" id="quickstart" href="#quickstart"></a>Quickstart</h2>

<ul>
<li>Install pim6sd from here: <a href="https://github.com/troglobit/pim6sd/">https://github.com/troglobit/pim6sd/</a>
<code>sh
cd /usr/src
git clone https://github.com/troglobit/pim6sd.git
cd pim6sd
./autogen.sh
./configure
make
</code>
</li>
<li>Find a peer who is already connected to the dn42 multicast backbone</li>
<li>
<p>Calculate your personal, embedded-RP multicast prefix matching your network prefix via <a href="https://tools.ietf.org/html/rfc3956">RFC3956</a></p>

<ul>
<li>Example:

<ul>
<li>Pattern: <code>ff7e:&lt;RIID&gt;&lt;plen&gt;:&lt;prefix&gt;::/96</code>

<ul>
<li>Prefix: <code>fd00:2001:db8::/48</code>
</li>
<li>Prefix length: <code>48 == 0x30</code>
</li>
<li>RIID: An arbitrary number between <code>0x1</code> and <code>0xf</code>, for instance <code>0x2</code>
</li>
</ul>
</li>
<li>Result:

<ul>
<li>Multicast prefix: <code>ff7e:230:fd00:2001:db8::/96</code>
</li>
<li>RP address: <code>fd00:2001:db8::&lt;RIID&gt;</code> -&gt; <code>fd00:2001:db8::2</code>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Create a dummy interface to hold your calculated unicast Rendezvous Point address. This one needs to be reachable from within dn42. Also set "multicast on" on this dummy interface. Example:</p>

<pre><code># /etc/network/interfaces.d/pim6sd
auto pim-router-id
iface pim-router-id inet manual
        pre-up ip link add name $IFACE type dummy
        post-up ip link set multicast on dev $IFACE
        post-up ip -6 a a fd00:2001:db8::2/128 dev $IFACE
        post-down ip link del $IFACE
</code></pre>
</li>
<li>
<p>Create the configuration file:</p>

<pre lang="sh" xml:lang="sh" xml:lang="sh"><code># /etc/pim6sd.conf
# disable all interfaces by default
default_phyint_status disable;

# enable the pim-router-id interface first to acquire the correct primary address
phyint pim-router-id enable;

# add multicast-capable peer interfaces below
phyint dn42-peer1 enable;

# configure rendezvous point for the personal multicast prefix
cand_rp pim-router-id;
group_prefix ff7e:230:fd00:2001:db8::/96;
</code></pre>

<p>The <code>phyint</code> statement enables <a href="https://tools.ietf.org/html/rfc7761">PIM</a> and <a href="https://tools.ietf.org/html/rfc2710">MLD</a> on the target interface - by default all interfaces are in the disable state. Enable an interface if it is directed towards a multicast-capable peer or other multicast-capable routers in your autonomous system. Also enable it for downstream network segments with multicast listeners and senders, like for example your home (W)LAN segments.</p>

<p>With <code>cand_rp</code> and <code>group_prefix</code> statements you can configure this router as a Rendezvous Point (RP) for your personal multicast group prefix. The address on the interface given as <code>cand_rp</code> will be used as the primary address for your RP, it therefore <em>must</em> be routable.</p>
</li>
</ul>

<hr />

<h2><a class="anchor" id="testing-applications" href="#testing-applications"></a>Testing &amp; Applications</h2>

<h3><a class="anchor" id="creating-a-test-network-namespace" href="#creating-a-test-network-namespace"></a>Creating a test network namespace</h3>

<p>On your router:</p>

<pre class="highlight"><code>allow-hotplug pim-ns0
iface pim-ns0 inet manual
    pre-up ip <span class="nb">link </span>add pim-ns0 <span class="nb">type </span>veth peer name pim-ns1
    post-up ip netns add pim-ns0
    post-up ip <span class="nb">link set </span>addr 02:11:22:00:00:02 netns pim-ns0 name pim-ns0 up dev pim-ns1
    post-up ip <span class="nb">link set </span>addr 02:11:22:00:00:01 up dev pim-ns0
    post-up ip <span class="nt">-6</span> a a fdd5:69d5:c530:1::1/64 dev pim-ns0
    post-up ip netns <span class="nb">exec </span>pim-ns0 ip <span class="nt">-6</span> a a fdd5:69d5:c530:1::2/64 dev pim-ns0
    post-up ip netns <span class="nb">exec </span>pim-ns0 ip <span class="nt">-6</span> r a default via fdd5:69d5:c530:1::1
    post-down ip <span class="nb">link </span>del pim-ns0
    post-down ip netns del pim-ns0</code></pre>

<p>You can now switch into this test network namespace via "ip netns exec /bin/bash". Inside this network namespace you can try:</p>

<h3><a class="anchor" id="creating-a-test-multicast-listener" href="#creating-a-test-multicast-listener"></a>Creating a test multicast listener</h3>

<pre class="highlight"><code>$ socat -u UDP6-RECV:1234,reuseaddr,ipv6-join-group="[ff7e:230:fdd5:69d5:c530::123]:eth0" -</code></pre>

<h3><a class="anchor" id="creating-a-test-multicast-sender" href="#creating-a-test-multicast-sender"></a>Creating a test multicast sender</h3>

<p>First select which interface should be the default one for your multicast traffic. Then send multicast packets via ICMPv6:</p>

<pre class="highlight"><code>$ ip -6 route add ff7e:230:fdd5:69d5:c530::/96 dev eth0 table local
$ ping6 -t 16 ff7e:230:fdd5:69d5:c530::123</code></pre>

<p>The "-t 16", a hop-limit of 16, is important here as <strong>by default all multicast traffic is usually send with a hop-limit of just 1</strong>.</p>

<hr />

<h2><a class="anchor" id="advanced-configurations" href="#advanced-configurations"></a>Advanced Configurations</h2>

<h3><a class="anchor" id="nomenclature" href="#nomenclature"></a>Nomenclature</h3>

<h4><a class="anchor" id="bootstrap-router-bsr" href="#bootstrap-router-bsr"></a>Bootstrap Router (BSR)</h4>

<p>Router that collects multicast group information from all RP in the network and advertises it across the network.</p>

<h4><a class="anchor" id="rendezvous-point-rp" href="#rendezvous-point-rp"></a>Rendezvous Point (RP)</h4>

<p>Router where senders and receivers will meet for a certain multicast address. Senders must send their data to it, after which it will be forwarded to receivers. As soon as a receivers DR learns of the sender it will ask their router to forward data along a direct path between sender and receiver.</p>

<h4><a class="anchor" id="designated-router-dr" href="#designated-router-dr"></a>Designated Router (DR)</h4>

<p>First-hop router that stand in for sender and receiver on their downstream networks. The senders DR sends their data towards the RP encapsulated in PIM Register packets. The receivers DR will send join and prune messages to the RP, managing the group subscription.</p>

<h3><a class="anchor" id="rfc3306-unicast-prefix-based-ipv6-multicast-addresses" href="#rfc3306-unicast-prefix-based-ipv6-multicast-addresses"></a>RFC3306: "Unicast-Prefix-based IPv6 Multicast Addresses"</h3>

<p>Before RFC3956 (embedded RP addresses) personal, network prefix based multicast prefixes were calculated via RFC3306. Example:</p>

<ul>
<li>
<p>Pattern: <code>ff3e:&lt;plen&gt;:&lt;prefix&gt;::/96</code></p>

<ul>
<li>Prefix: <code>fd00:2001:db8::/48</code>

<ul>
<li>Prefix length: <code>48 == 0x30</code>
</li>
</ul>
</li>
<li>Result: <code>ff3e:30:fd00:2001:db8::/96</code>
</li>
</ul>
</li>
<li>
<p>Pros:</p>

<ul>
<li>More flexible RP address selection</li>
<li>Allows filtering on the BSR</li>
</ul>
</li>
<li>
<p>Cons:</p>

<ul>
<li>Needs a central BSR for coordination (or static RP configuration)</li>
<li>Allows filtering on the BSR</li>
</ul>
</li>
</ul>

<p>However you can usually just announce and use both RFC3306 and RFC3956 based multicast prefixes, if you want to. pim6sd allows adding multiple <code>group_prefix</code> entries.</p>

<h3><a class="anchor" id="address-management" href="#address-management"></a>Address Management</h3>

<h4><a class="anchor" id="bootstrap-router" href="#bootstrap-router"></a>Bootstrap Router</h4>

<p>If you want to be participate as a bootstrap router candidate, please read up on how PIM works first. If you join with a bootstrap router candidate add it here below with contact information and join #dn42-multicast on HackInt:</p>

<ul>
<li> - <a href="mailto:foo@example.com">foo@example.com</a>, foo@HackInt</li>
<li> - ...</li>
</ul>

<h4><a class="anchor" id="shared-multicast-addresses" href="#shared-multicast-addresses"></a>Shared multicast addresses</h4>

<p>Next to personal multicast prefixes generated by network prefix (RFC3306 or RFC3956) there can also be multicast addresses not owned by a specific AS. In general any one can just set up a multicast sender or listener for those. However to work, they need a reliable RP for coordination.</p>

<p>If you want to offer an RP candidate for a shared multicast address, please read up on how PIM works first. If you join with an RP candidate for a shared multicast address add it here below with contact information and join #dn42-multicast on HackInt:</p>

<ul>
<li>/128:

<ul>
<li> - <a href="mailto:foo@example.com">foo@example.com</a>, foo@HackInt</li>
<li> - <a href="mailto:bar@example.com">bar@example.com</a>, bar@HackInt</li>
</ul></li>
<li>/128:

<ul>
<li>...</li>
</ul></li>
</ul>

<h2><a class="anchor" id="questions" href="#questions"></a>Questions?</h2>

<ul>
<li>Join: <code>#dn42-multicast</code> on <code>HackInt</code>
</li>
</ul>

<hr />

<p>ToDo:</p>

<ul>
<li>We have a solution for personal multicast prefixes tied to the network prefix of an AS owner. But what to do with multicast addresses that not only have listeners but also senders globally? We could have everyone add an additional "group_prefix ff00::/8" and then multicast router with the lowest address would win and become the central RP for all these addresses... not really scalable, robust or decentral though :-/. Should we use PIM-DM for some of these addresses instead (e.g. ones which generally have a low throughput, for instance Bittorrent Local Peer Discovery)? Or maybe those global addresses should be managed and configured as /128 and people who are interested in managing a specific, global multicast address will coordinate with each other?</li>
<li>bootstrap router coordination; according to RFCs a bootstrap router can alter/filter the multicast prefixes it received from candidate RPs. Should a bootstrap router check and filter any multicast prefix that was generated from a network prefix which does not match the network prefix used by the PR?</li>
</ul>

	      </div>
          <div id="wiki-sidebar" class="Box Box--condensed float-md-left col-md-3">
	        <div id="sidebar-content" class="gollum-markdown-content markdown-body px-4">
	          <ul>
<li>
<a href="../Home.html" rel="nofollow">Home</a>

<ul>
<li><a href="Getting-Started.html" rel="nofollow">Getting Started</a></li>
<li><a href="Registry-Authentication.html" rel="nofollow">Registry Authentication</a></li>
<li><a href="Address-Space.html" rel="nofollow">Address Space</a></li>
<li><a href="Bird-communities.html" rel="nofollow">BGP communities</a></li>
<li><a href="../FAQ.html" rel="nofollow">FAQ</a></li>
</ul>
</li>
</ul>

<ul>
<li>
<p>How-To</p>

<ul>
<li><a href="wireguard.html" rel="nofollow">Wireguard</a></li>
<li><a href="openvpn.html" rel="nofollow">Openvpn</a></li>
<li><a href="IPsec-with-PublicKeys.html" rel="nofollow">IPsec With Public Keys</a></li>
<li><a href="tinc.html" rel="nofollow">Tinc</a></li>
<li><a href="GRE-on-FreeBSD.html" rel="nofollow">GRE on FreeBSD</a></li>
<li><a href="GRE-on-OpenBSD.html" rel="nofollow">GRE on OpenBSD</a></li>
<li><a href="IPv6-Multicast.html" rel="nofollow">IPv6 Multicast (PIM-SM)</a></li>
<li>
<a href="Bird.html" rel="nofollow">Bird</a> / <a href="Bird2.html" rel="nofollow">Bird2</a>
</li>
<li><a href="Quagga.html" rel="nofollow">Quagga</a></li>
<li><a href="OpenBGPD.html" rel="nofollow">OpenBGPD</a></li>
<li><a href="mikrotik.html" rel="nofollow">Mikrotik RouterOS</a></li>
<li><a href="EdgeOS-Config.html" rel="nofollow">EdgeRouter</a></li>
<li><a href="Static-routes-on-Windows.html" rel="nofollow">Static routes on Windows</a></li>
<li><a href="networksettings.html" rel="nofollow">Universal Network Requirements</a></li>
<li><a href="vyos.html" rel="nofollow">VyOS</a></li>
<li><a href="nixos.html" rel="nofollow">NixOS</a></li>
</ul>
</li>
<li>
<p>Services</p>

<ul>
<li><a href="../services/IRC.html" rel="nofollow">IRC</a></li>
<li><a href="../services/Whois.html" rel="nofollow">Whois registry</a></li>
<li><a href="../services/DNS.html" rel="nofollow">DNS</a></li>
<li><a href="../services/Clearnet-Domains.html" rel="nofollow">Public DNS</a></li>
<li><a href="../services/Looking-Glasses.html" rel="nofollow">Looking Glasses</a></li>
<li><a href="../services/Automatic-Peering.html" rel="nofollow">Automatic Peering</a></li>
<li><a href="../services/Repository-Mirrors.html" rel="nofollow">Repository Mirrors</a></li>
<li><a href="../services/Distributed-Wiki.html" rel="nofollow">Distributed Wiki</a></li>
<li><a href="../services/Certificate-Authority.html" rel="nofollow">Certificate Authority</a></li>
<li><a href="../services/Route-Collector.html" rel="nofollow">Route Collector</a></li>
</ul>
</li>
<li>
<p>Internal</p>

<ul>
<li><a href="../internal/Internal-Services.html" rel="nofollow">Internal services</a></li>
<li><a href="../internal/Interconnections.html" rel="nofollow">Interconnections</a></li>
<li><a href="../internal/APIs.html" rel="nofollow">APIs</a></li>
<li>
<a href="../internal/ShowAndTell.html" rel="nofollow">Show and Tell</a><br />
</li>
<li><a href="../internal/Historical-Services.html" rel="nofollow">Historical services</a></li>
</ul>
</li>
<li>
<p>External Tools</p>

<ul>
<li><a href="https://paste.dn42.us/" rel="nofollow">Paste Board</a></li>
<li><a href="https://git.dn42.dev/" rel="nofollow">Git Repositories</a></li>
</ul>
</li>
</ul>

<hr />

	        </div>
	      </div>
	    </div>
	  </div>
	  <div id="wiki-footer" class="gollum-markdown-content my-2">
	    <div id="footer-content" class="Box Box-condensed markdown-body px-4">
	      <p>Hosted by: <a href="mailto:xuu@sour.is" rel="nofollow">xuu</a>, <a href="mailto:nurtic-vibe@grmml.net" rel="nofollow">nurtic-vibe</a>, <a href="mailto:tom@xcv.vc" rel="nofollow">toBee</a>, <a href="mailto:dn42@burble.com" rel="nofollow">burble</a> | Accessible via: <a href="https://wiki.dn42/" rel="nofollow">dn42</a>, <a href="https://dn42.eu/" rel="nofollow">dn42.eu</a>, <a href="https://dn42.dev/" rel="nofollow">dn42.dev</a></p>

	    </div>
	  </div>


	</div>


	<div id="footer" class="pt-4">
		  <p id="last-edit"><div class="dotted-spinner hidden"></div> <a id="page-info-toggle" data-pagepath="howto/IPv6-Multicast.md">When was this page last modified?</a></p>
	</div>


</div>

<form name="rename" method="POST" action="http://127.0.0.1:4567/gollum/rename/howto/IPv6-Multicast.md">
  <input type="hidden" name="rename"/>
  <input type="hidden" name="message"/>
</form>

</div>
</div>
</body>

<!-- Mirrored from 127.0.0.1:4567/howto/IPv6-Multicast.md by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 15 Aug 2022 13:08:48 GMT -->
</html>
