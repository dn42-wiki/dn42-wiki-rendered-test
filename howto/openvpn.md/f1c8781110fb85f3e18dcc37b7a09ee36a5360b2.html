<!DOCTYPE html>
<html>

<!-- Mirrored from 127.0.0.1:4567/howto/openvpn.md/f1c8781110fb85f3e18dcc37b7a09ee36a5360b2 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 15 Aug 2022 13:08:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta http-equiv="Content-type" content="text/html;charset=utf-8">
  <meta name="MobileOptimized" content="width">
  <meta name="HandheldFriendly" content="true">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" type="text/css" href="../../gollum/assets/app-309be032396e783b13a47df58f389b7c8e11c2b2d42640560b874f677c25f6e5.css" media="all">
  <link rel="stylesheet" type="text/css" href="../../gollum/assets/print-512498c368be0d3fb1ba105dfa84289ae48380ec9fcbef948bd4e23b0b095bfb.css" media="print">

  <link rel="stylesheet" type="text/css" href="../../custom.css" media="all">
  <meta name="robots" content="noindex, nofollow" />

  <script>
  var criticMarkup = '';
	var baseUrl = '';
  var showLocalTime = false;
	var uploadDest = 'uploads';
	var perPageUploads = '';
	if (perPageUploads == 'true') {
	  uploadDest = uploadDest + window.location.pathname.replace(/.*gollum\/[-\w]+\//, "/").replace(/\.[^/.]+$/, "").replace(baseUrl, "")
	}
	  var pageFullPath = 'howto/openvpn.md';
    var pageFormat   = 'markdown';

  </script>
  <script src="http://127.0.0.1:4567/gollum/assets/app-f05401ee374f0c7f48fc2bc08e30b4f4db705861fd5895ed70998683b383bfb5.js" type="text/javascript"></script>
  

  <title>openvpn</title>
</head>
<body>
<div class="container-lg clearfix">
<div id="wiki-wrapper" class="page">
<div id="head">
	<nav class="TableObject
            actions
            border-bottom
            border-md-0
            p-2
            pt-lg-4
            px-lg-0
            overflow-x-scroll">
  <div class="TableObject-item hide-lg hide-xl">
    <details class="details-reset details-overlay">
      <summary class="btn btn-invisible" aria-haspopup="true">
        <span aria-label="Open menu">â˜°</span>
      </summary>
    
      <div class="SelectMenu mx-sm-2">
        <div class="SelectMenu-modal">
          <div class="SelectMenu-divider py-3">
            <h2 class="h6">Current Page</h2>
            <div>openvpn</div>
          </div>
    
            <a
              class="SelectMenu-item"
              href="http://127.0.0.1:4567/gollum/history/howto/openvpn.md"
              role="menuitem"
            >
              <span>History</span>
            </a>
    
    
          <div class="SelectMenu-divider py-3">
            <h2 class="h6">Main Menu</h2>
          </div>
    
          <div class="SelectMenu-list">
            <a class="SelectMenu-item" role="menuitem" href="http://127.0.0.1:4567/">
              Home
            </a>
    
              <a class="SelectMenu-item" role="menuitem" href="http://127.0.0.1:4567/gollum/overview">
                Overview
              </a>
    
              <a
                class="SelectMenu-item"
                href="http://127.0.0.1:4567/gollum/latest_changes"
                role="menuitem"
              >
                Latest Changes
              </a>
          </div>
        </div>
      </div>
    </details>
  </div>

  <div class="TableObject-item hide-sm hide-md">
    <a class="btn btn-sm" id="minibutton-home" href="http://127.0.0.1:4567/">
      Home
    </a>
  </div>

  <div
    class="TableObject-item TableObject-item--primary px-2"
    
  >
    <form class="search-form" action="http://127.0.0.1:4567/gollum/search" method="get" id="search-form">
    	<input type="text" class="form-control input-block" name="q" id="search-query" placeholder="Search" aria-label="Search site" autocomplete="off">
    </form>  </div>

  <div class="TableObject-item hide-sm hide-md">
    <div class="BtnGroup d-flex">
        <a
          class="btn BtnGroup-item btn-sm"
          href="http://127.0.0.1:4567/gollum/overview"
          id="minibutton-overview"
        >
          Overview
        </a>

        <a
          class="btn BtnGroup-item btn-sm"
          href="http://127.0.0.1:4567/gollum/latest_changes"
          id="minibutton-latest-changes"
        >
          Latest Changes
        </a>
    </div>
  </div>

  <div class="TableObject-item px-2">
    <div class="BtnGroup d-flex">
        <a
          class="btn BtnGroup-item btn-sm hide-sm hide-md"
          href="http://127.0.0.1:4567/gollum/history/howto/openvpn.md/f1c8781110fb85f3e18dcc37b7a09ee36a5360b2"
          id="minibutton-history"
        >
          History
        </a>

    </div>
  </div>

</nav>

</div>

<div id="wiki-content" class="px-2 px-lg-0">
  <h1 class="header-title text-center text-md-left pt-4">
    openvpn
  </h1>
	<div class="breadcrumb"><nav aria-label="Breadcrumb"><ol>
<li class="breadcrumb-item"><a href="http://127.0.0.1:4567/gollum/overview/howto/">howto</a></li>
</ol></nav></div>

	<div class="has-header has-footer has-sidebar has-rightbar">
	  <div id="wiki-body" class="gollum-markdown-content">
	    <div id="wiki-header" class="gollum-markdown-content">
	      <div id="header-content" class="markdown-body">
	        <p><a href="http://127.0.0.1:4567/" rel="nofollow"><img src="http://127.0.0.1:4567/dn42.png" alt="dn42" /></a></p>

	      </div>
	    </div>
	    <div class="main-content clearfix container-lg">
	      <div class="markdown-body  float-md-left col-md-9" >
	        
	        <h1><a class="anchor" id="example-configuration-for-direct-peer-to-peer" href="#example-configuration-for-direct-peer-to-peer"></a>Example Configuration for direct peer to peer</h1>

<ul>
<li>Replace <code>&lt;PEER_NAME&gt;</code> with a self chosen name to identify this peer</li>
<li>Replace <code>&lt;PROTO&gt;</code> with either <code>udp</code> or <code>udp6</code>, depending if you reach your remote peer with ipv4 o ipv6</li>
<li>Replace <code>&lt;REMOTE_HOST&gt;</code> with the public ip address of your peer</li>
<li>Replace <code>&lt;REMOTE_PORT&gt;</code> with the port number, where your peer's openvpn daemon listen for traffic</li>
<li>Replace <code>&lt;LOCAL_HOST&gt;</code> with your public ip</li>
<li>Replace <code>&lt;INTERFACE_NAME&gt;</code> with a self chosen name, this will be the name of your network interface (tun device) for this peering</li>
<li>Replace <code>&lt;LOCAL_GATEWAY_IP&gt;</code> with your own dn42 ip address</li>
<li>Replace <code>&lt;REMOTE_GATEWAY_IP&gt;</code> with dn42 ip address of your peer</li>
<li>
<code>&lt;LOCAL_GATEWAY_IPV6&gt; &lt;REMOTE_GATEWAY_IPV6&gt;</code> same as ipv4, but both ip addresses needs to be in the same subnet. For simplicity you can always use an address from link-local ipv6 range (fe80::/64)</li>
</ul>

<pre class="highlight"><code>#/etc/openvpn/&lt;PEER_NAME&gt;
proto       &lt;PROTO&gt;
mode        p2p
remote      &lt;REMOTE_HOST&gt;
rport       &lt;REMOTE_PORT&gt;
local       &lt;LOCAL_HOST&gt;
lport       &lt;LOCAL_PORT&gt;
dev-type    tun
tun-ipv6
resolv-retry infinite
dev         &lt;INTERFACE_NAME&gt;
comp-lzo
persist-key
persist-tun
cipher aes-256-cbc
ifconfig-ipv6 &lt;LOCAL_GATEWAY_IPV6&gt; &lt;REMOTE_GATEWAY_IPV6&gt;
ifconfig &lt;LOCAL_GATEWAY_IP&gt;  &lt;REMOTE_GATEWAY_IP&gt;
secret /etc/openvpn/&lt;PEER_NAME&gt;.key

# The secret can also be included inline with the config by 
#   wrapping it in &lt;secret&gt;&lt;/secret&gt; tags.
# &lt;secret&gt;
# ... Key File contents go here ...
# &lt;/secret&gt;</code></pre>

<p>then create a new key and share it with your peer</p>

<pre class="highlight"><code>$ openvpn --genkey --secret /etc/openvpn/&lt;PEER_NAME&gt;.key</code></pre>

<h1><a class="anchor" id="example-configuration-if-one-peer-has-a-floating-ip" href="#example-configuration-if-one-peer-has-a-floating-ip"></a>Example Configuration if one peer has a floating ip</h1>

<h2><a class="anchor" id="peer-with-fixed-ip" href="#peer-with-fixed-ip"></a>peer with fixed ip</h2>

<pre class="highlight"><code>proto       &lt;PROTO&gt;
mode        p2p
dev-type    tun
comp-lzo
dev  &lt;INTERFACE_NAME&gt;
persist-key
persist-tun
tun-ipv6
cipher aes-256-cbc
resolv-retry infinite
float
port &lt;LOCAL_PORT&gt;
ifconfig-ipv6 &lt;LOCAL_GATEWAY_IPV6&gt; &lt;REMOTE_GATEWAY_IPV6&gt;
ifconfig  &lt;LOCAL_GATEWAY_IP&gt;  &lt;REMOTE_GATEWAY_IP&gt;
secret /etc/openvpn/&lt;PEER_NAME&gt;.key</code></pre>

<h2><a class="anchor" id="peer-with-floating-ip" href="#peer-with-floating-ip"></a>peer with floating ip</h2>

<ul>
<li>Notice the local gateway ip of your peer is your remote gateway ip and 
his remote gateway is your local gateway</li>
<li>
<code>&lt;REMOTE_HOST&gt;</code> is the ip address of your peer</li>
<li>
<code>&lt;REMOTE_PORT&gt;</code> is openvpn port, where your peer listen for traffic</li>
</ul>

<pre class="highlight"><code>proto       &lt;PROTO&gt;
mode        p2p
remote      &lt;REMOTE_HOST&gt;
rport       &lt;REMOTE_PORT&gt;
lport       float
dev-type    tun
tun-ipv6
dev         &lt;INTERFACE_NAME&gt;
comp-lzo
persist-key
persist-tun
cipher aes-256-cbc
resolv-retry infinite
ifconfig  &lt;LOCAL_GATEWAY_IP&gt;  &lt;REMOTE_GATEWAY_IP&gt;
ifconfig-ipv6 &lt;LOCAL_GATEWAY_IPV6&gt; &lt;LOCAL_GATEWAY_IPV6&gt;
secret /etc/openvpn/&lt;PEER_NAME&gt;.key</code></pre>

<h1><a class="anchor" id="example-configuration-for-connecting-roaming-clients-to-dn42" href="#example-configuration-for-connecting-roaming-clients-to-dn42"></a>Example configuration for connecting roaming clients to dn42</h1>

<p>Clients connect using certificates, and simply get attributed dn42 IPs in the order they connect.  This is useful for roaming clients, where you don't really care which IP you have.  Note that once a client has connected for the first time, it will keep the same IP on subsequent connections (option <code>ifconfig-pool-persist</code>).</p>

<h2><a class="anchor" id="server-configuration" href="#server-configuration"></a>Server configuration</h2>

<p>Replace <code>&lt;PORT&gt;</code> with the UDP port you want OpenVPN to listen to, and change the IP ranges (<code>ifconfig</code> and <code>route-gateway</code> options).</p>

<pre class="highlight"><code>mode server
tls-server

dh dh2048.pem
cipher aes-256-cbc

ca keys/ca.crt
cert keys/roaming-dn42.crt
key keys/roaming-dn42.key

client-config-dir /etc/openvpn/roaming

dev tun-roaming
persist-tun
tun-ipv6
tun-mtu 1500
fragment 1300
mssfix
log /var/log/openvpn-dn42-roaming.log
status /var/log/openvpn-dn42-roaming-status.log 60

# Should work for both IPv4 and IPv6
proto udp6
port &lt;PORT&gt;

# IPv6
###tun-ipv6
###push tun-ipv6
###ifconfig-ipv6 2001:db8:42:42::1 2001:db8:42:42::2
###ifconfig-ipv6-pool 2001:db8:42:42::3/64

topology subnet
push "topology subnet"

keepalive 10 60

# That's 172.22.X.144/28 (172.22.X.144 to 172.22.X.159)
ifconfig 172.22.X.145 255.255.255.240
ifconfig-pool 172.22.X.146 172.22.X.158 255.255.255.240

ifconfig-pool-persist pool-persist.txt

push "route-gateway 172.22.X.145"
push "route 172.22.0.0 255.254.0.0" 
###push "route 172.31.0.0 255.255.0.0" 
###push "route 10.0.0.0 255.0.0.0" </code></pre>

<h2><a class="anchor" id="client-configuration" href="#client-configuration"></a>Client configuration</h2>

<p>Change <code>&lt;SERVER&gt;</code> and <code>&lt;PORT&gt;</code>.</p>

<pre class="highlight"><code>client

ca   ca.crt
cert myclient.crt
key  myclient.key

dev tun
proto udp6
cipher aes-256-cbc

remote &lt;SERVER&gt; &lt;PORT&gt;

tun-mtu 1500
fragment 1300
mssfix

route-delay 2
nobind
persist-key
persist-tun
resolv-retry infinite

verb 3</code></pre>

<h2><a class="anchor" id="certificate-management" href="#certificate-management"></a>Certificate management</h2>

<p>Use easy-rsa, it's easy to use.  Below is a very short description, find a real tutorial if you don't know how it works.</p>

<p>Build the CA: <code>. vars</code>, <code>./build-ca</code>, then generate the server key: <code>./build-key-server roaming-dn42</code>.</p>

<p>Then, for each client, generate a private key and a certificate: <code>./build-key myclient</code>.  The Common Name is the only important information (it will be used to identify the client, for instance in the logs).</p>

<h1><a class="anchor" id="see-also" href="#see-also"></a>See also</h1>

<ul>
<li><a href="https://internal.dn42/howto/networksettings" rel="nofollow">Network settings</a></li>
</ul>

<h1><a class="anchor" id="external-links" href="#external-links"></a>External Links</h1>

<ul>
<li>
<p>multicast: </p>

<ul>
<li><strong>OpenVPN</strong></li>
<li><a href="https://community.openvpn.net/openvpn/ticket/79" rel="nofollow">Optimizations for multicast over TAP w/ OpenVPN</a></li>
<li><p><a href="http://forums.openvpn.net/topic8036.html" rel="nofollow">Sending multicast over a openvpn tunnel</a></p></li>
<li><p><strong>RFC</strong></p></li>
<li><a href="https://tools.ietf.org/html/rfc3306" rel="nofollow">IPv6 - RFC3306</a></li>
<li><a href="https://en.wikipedia.org/wiki/Multicast_address#GLOP_addressing" rel="nofollow">IPv4 - multicast</a></li>
<li><a href="http://labs.spritelink.net/glop" rel="nofollow">IPv4 - GLOB calculator</a></li>
<li><a href="http://tools.ietf.org/html/rfc3180" rel="nofollow">RFC3108 GLOP Addressing in 233/8</a></li>
<li><a href="https://tools.ietf.org/html/rfc3138" rel="nofollow">RFC3138 Extended Assignments in 233/8</a></li>
</ul>
</li>
</ul>

	      </div>
          <div id="wiki-sidebar" class="Box Box--condensed float-md-left col-md-3">
	        <div id="sidebar-content" class="gollum-markdown-content markdown-body px-4">
	          <ul>
<li>
<a href="http://127.0.0.1:4567/Home" rel="nofollow">Home</a>

<ul>
<li><a href="http://127.0.0.1:4567/howto/Getting-Started" rel="nofollow">Getting Started</a></li>
<li><a href="http://127.0.0.1:4567/howto/Registry-Authentication" rel="nofollow">Registry Authentication</a></li>
<li><a href="http://127.0.0.1:4567/howto/Address-Space" rel="nofollow">Address Space</a></li>
<li><a href="http://127.0.0.1:4567/howto/Bird-communities" rel="nofollow">BGP communities</a></li>
<li><a href="http://127.0.0.1:4567/FAQ" rel="nofollow">FAQ</a></li>
</ul>
</li>
</ul>

<ul>
<li>
<p>How-To</p>

<ul>
<li><a href="http://127.0.0.1:4567/howto/wireguard" rel="nofollow">Wireguard</a></li>
<li><a href="http://127.0.0.1:4567/howto/openvpn" rel="nofollow">Openvpn</a></li>
<li><a href="http://127.0.0.1:4567/howto/IPsec-with-PublicKeys" rel="nofollow">IPsec With Public Keys</a></li>
<li><a href="http://127.0.0.1:4567/howto/tinc" rel="nofollow">Tinc</a></li>
<li><a href="http://127.0.0.1:4567/howto/GRE-on-FreeBSD" rel="nofollow">GRE on FreeBSD</a></li>
<li><a href="http://127.0.0.1:4567/howto/GRE-on-OpenBSD" rel="nofollow">GRE on OpenBSD</a></li>
<li><a href="http://127.0.0.1:4567/howto/IPv6-Multicast" rel="nofollow">IPv6 Multicast (PIM-SM)</a></li>
<li>
<a href="http://127.0.0.1:4567/howto/Bird" rel="nofollow">Bird</a> / <a href="http://127.0.0.1:4567/howto/Bird2" rel="nofollow">Bird2</a>
</li>
<li><a href="http://127.0.0.1:4567/howto/Quagga" rel="nofollow">Quagga</a></li>
<li><a href="http://127.0.0.1:4567/howto/OpenBGPD" rel="nofollow">OpenBGPD</a></li>
<li><a href="http://127.0.0.1:4567/howto/mikrotik" rel="nofollow">Mikrotik RouterOS</a></li>
<li><a href="http://127.0.0.1:4567/howto/EdgeOS-Config" rel="nofollow">EdgeRouter</a></li>
<li><a href="http://127.0.0.1:4567/howto/Static-routes-on-Windows" rel="nofollow">Static routes on Windows</a></li>
<li><a href="http://127.0.0.1:4567/howto/networksettings" rel="nofollow">Universal Network Requirements</a></li>
<li><a href="http://127.0.0.1:4567/howto/vyos" rel="nofollow">VyOS</a></li>
<li><a href="http://127.0.0.1:4567/howto/nixos" rel="nofollow">NixOS</a></li>
</ul>
</li>
<li>
<p>Services</p>

<ul>
<li><a href="http://127.0.0.1:4567/services/IRC" rel="nofollow">IRC</a></li>
<li><a href="http://127.0.0.1:4567/services/Whois" rel="nofollow">Whois registry</a></li>
<li><a href="http://127.0.0.1:4567/services/DNS" rel="nofollow">DNS</a></li>
<li><a href="http://127.0.0.1:4567/services/Clearnet-Domains" rel="nofollow">Public DNS</a></li>
<li><a href="http://127.0.0.1:4567/services/Looking-Glasses" rel="nofollow">Looking Glasses</a></li>
<li><a href="http://127.0.0.1:4567/services/Automatic-Peering" rel="nofollow">Automatic Peering</a></li>
<li><a href="http://127.0.0.1:4567/services/Repository-Mirrors" rel="nofollow">Repository Mirrors</a></li>
<li><a href="http://127.0.0.1:4567/services/Distributed-Wiki" rel="nofollow">Distributed Wiki</a></li>
<li><a href="http://127.0.0.1:4567/services/Certificate-Authority" rel="nofollow">Certificate Authority</a></li>
<li><a href="http://127.0.0.1:4567/services/Route-Collector" rel="nofollow">Route Collector</a></li>
</ul>
</li>
<li>
<p>Internal</p>

<ul>
<li><a href="http://127.0.0.1:4567/internal/Internal-Services" rel="nofollow">Internal services</a></li>
<li><a href="http://127.0.0.1:4567/internal/Interconnections" rel="nofollow">Interconnections</a></li>
<li><a href="http://127.0.0.1:4567/internal/APIs" rel="nofollow">APIs</a></li>
<li>
<a href="http://127.0.0.1:4567/internal/ShowAndTell" rel="nofollow">Show and Tell</a><br />
</li>
<li><a href="http://127.0.0.1:4567/internal/Historical-Services" rel="nofollow">Historical services</a></li>
</ul>
</li>
<li>
<p>External Tools</p>

<ul>
<li><a href="https://paste.dn42.us/" rel="nofollow">Paste Board</a></li>
<li><a href="https://git.dn42.dev/" rel="nofollow">Git Repositories</a></li>
</ul>
</li>
</ul>

<hr />

	        </div>
	      </div>
	    </div>
	  </div>
	  <div id="wiki-footer" class="gollum-markdown-content my-2">
	    <div id="footer-content" class="Box Box-condensed markdown-body px-4">
	      <p>Hosted by: <a href="mailto:xuu@sour.is" rel="nofollow">xuu</a>, <a href="mailto:nurtic-vibe@grmml.net" rel="nofollow">nurtic-vibe</a>, <a href="mailto:tom@xcv.vc" rel="nofollow">toBee</a>, <a href="mailto:dn42@burble.com" rel="nofollow">burble</a> | Accessible via: <a href="https://wiki.dn42/" rel="nofollow">dn42</a>, <a href="https://dn42.eu/" rel="nofollow">dn42.eu</a>, <a href="https://dn42.dev/" rel="nofollow">dn42.dev</a></p>

	    </div>
	  </div>


	</div>


	<div id="footer" class="pt-4">
	    <p>This version of the page was edited by <b>KIOUBIT-MNT</b> at <time datetime="2021-05-31T21:48:53Z" data-format="%Y-%m-%d %H:%M:%S">2021-06-01 00:48:53</time>. <a href="http://127.0.0.1:4567/howto/openvpn.md">View the most recent version.</a></p>
	</div>


</div>

<form name="rename" method="POST" action="http://127.0.0.1:4567/gollum/rename/howto/openvpn.md">
  <input type="hidden" name="rename"/>
  <input type="hidden" name="message"/>
</form>

</div>
</div>
</body>

<!-- Mirrored from 127.0.0.1:4567/howto/openvpn.md/f1c8781110fb85f3e18dcc37b7a09ee36a5360b2 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 15 Aug 2022 13:08:49 GMT -->
</html>
